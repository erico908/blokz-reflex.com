<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
  <title>Blokz Reflex</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', sans-serif; }
    body { background: linear-gradient(to bottom right, #1f1f1f, #000); color: white; overflow: hidden; }

    .page { display: none; padding: 2rem; text-align: center; height: 100vh; }
    .active { display: flex; flex-direction: column; justify-content: center; align-items: center; }

    h1 { font-size: 3rem; color: #00ffc8; }

    .btn {
      margin: 1rem;
      padding: 1rem 2rem;
      font-size: 1.2rem;
      background: #00ffc8;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      user-select: none;
    }

    .btn:hover { background: #00ccaa; }

    #gameArea {
      width: 100%;
      max-width: 800px;
      height: 80vh;
      border: 2px solid #00ffc8;
      margin: auto;
      position: relative;
      background: #111;
      border-radius: 20px;
      overflow: hidden;
      touch-action: manipulation;
    }

    .block {
      width: 60px;
      height: 60px;
      position: absolute;
      border-radius: 10px;
      cursor: pointer;
      user-select: none;
    }

    .gray { background: gray; }
    .red { background: #ff4d4d; }
    .blue { background: #4d94ff; }
    .green { background: #4dff88; }
    .yellow { background: #ffff4d; }

    .hud {
      display: flex;
      justify-content: space-between;
      width: 90%;
      margin: 1rem auto;
      font-size: 1.2rem;
      flex-wrap: wrap;
      gap: 1rem;
    }

    .topbar {
      position: absolute;
      top: 1rem;
      right: 1rem;
      display: flex;
      gap: 0.5rem;
      flex-wrap: wrap;
      justify-content: flex-end;
    }

    .link-btn {
      background: transparent;
      border: 1px solid #00ffc8;
      color: #00ffc8;
      padding: 0.5rem 1rem;
      border-radius: 8px;
      cursor: pointer;
      user-select: none;
      font-size: 1rem;
    }
    .link-btn:hover {
      background: #00ccaa;
      color: #000;
      border-color: #00ccaa;
    }

    .store-item {
      background: #222;
      padding: 1rem;
      margin: 1rem;
      border-radius: 10px;
      border: 1px solid #444;
      max-width: 400px;
      user-select: none;
    }

    .store-item h3 { margin-bottom: 0.5rem; }

    .store-item button {
      background: #00ffc8;
      border: none;
      padding: 0.5rem 1rem;
      border-radius: 8px;
      cursor: pointer;
      user-select: none;
      font-size: 1rem;
    }

    #countdown {
      font-size: 5rem;
      font-weight: bold;
      margin-top: 2rem;
      user-select: none;
    }

    /* Ajustements mobiles */
    @media (max-width: 600px) {
      h1 { font-size: 2.2rem; }
      .btn { padding: 0.8rem 1.5rem; font-size: 1rem; }
      #gameArea { height: 60vh; }
      .block { width: 50px; height: 50px; }
      .hud { font-size: 1rem; }
      .topbar { top: 0.5rem; right: 0.5rem; }
    }
  </style>
</head>
<body>
  <!-- ACCUEIL -->
  <div id="home" class="page active">
    <h1>Blokz Reflex</h1>
    <p>ğŸ¯ Clique sur les blocs colorÃ©s pour gagner des ğŸ†.</p>
    <p>âŒ Ã‰vite les blocs gris. Rater un bloc colorÃ© = -1 â¤ï¸</p>
    <p>ğŸ’¾ TrophÃ©es et amÃ©liorations sont sauvegardÃ©s automatiquement.</p>
    <button class="btn" onclick="chooseDifficulty('easy')">Facile</button>
    <button class="btn" onclick="chooseDifficulty('medium')">Moyen</button>
    <button class="btn" onclick="chooseDifficulty('impossible')">Impossible</button>
    <button class="btn" onclick="goToLocal()">Local</button>
    <div class="topbar">
      <button class="link-btn" onclick="showPage('shop')">ğŸª Boutique</button>
      <button class="link-btn" onclick="showPage('profile')">ğŸ‘¤ Profil</button>
    </div>
  </div>

  <!-- Ã‰CRAN PRÃŠT -->
  <div id="ready" class="page">
    <h1>Tu es prÃªt ?</h1>
    <p>Le jeu commence dÃ¨s que tu appuies sur <strong>Commencer</strong>.</p>
    <button class="btn" onclick="startGame()">Commencer</button>
    <button class="btn" onclick="showPage('home')">Retour</button>
  </div>

  <!-- JEU -->
  <div id="game" class="page">
    <div class="hud">
      <div>â¤ï¸ Vies : <span id="lives"></span></div>
      <div>ğŸ† TrophÃ©es : <span id="trophies"></span></div>
      <div>ğŸ”¥ Multiplicateur : x<span id="multiplier"></span></div>
      <div>ğŸ“ˆ Score : <span id="score"></span></div>
    </div>
    <div id="countdown"></div>
    <div id="gameArea"></div>
    <div class="topbar">
      <button class="link-btn" onclick="endGame()">ğŸ  Quitter</button>
    </div>
  </div>

  <!-- BOUTIQUE -->
  <div id="shop" class="page">
    <h1>Boutique ğŸ›’</h1>
    <div class="store-item">
      <h3>â¤ï¸ Vie SupplÃ©mentaire â€” 50 ğŸ†</h3>
      <button onclick="buyLife()">Acheter</button>
    </div>
    <div class="store-item">
      <h3>ğŸ”¥ Multiplicateur x<span id="shopMultiplier"></span> â†’ x<span id="nextMultiplier"></span> â€” <span id="multiplierCost"></span> ğŸ†</h3>
      <button onclick="upgradeMultiplier()">AmÃ©liorer</button>
    </div>
    <button class="btn" onclick="showPage('home')">Retour</button>
  </div>

  <!-- PROFIL -->
  <div id="profile" class="page">
    <h1>Profil ğŸ‘¤</h1>
    <p>ğŸ† TrophÃ©es : <span id="profileTrophies"></span></p>
    <p>â¤ï¸ Vies : <span id="profileLives"></span></p>
    <p>ğŸ”¥ Multiplicateur : x<span id="profileMultiplier"></span></p>
    <button class="btn" onclick="showPage('home')">Retour</button>
  </div>

  <!-- MODE LOCAL -->
  <div id="local" class="page">
    <h1>Mode Local</h1>
    <p>Mode multijoueur local Ã  venir !</p>
    <button class="btn" onclick="showPage('home')">Retour</button>
  </div>

  <script>
    const pages = ["home", "ready", "game", "shop", "profile", "local"];
    const colors = ['red', 'blue', 'green', 'yellow'];
    const difficulties = { easy: 5000, medium: 3000, impossible: 1500 };
    let gameDifficulty = null;
    let gameTimer = null;
    let blocks = [];
    let score = 0;
    let lives = 3;
    let trophies = 0;
    let multiplier = 1;
    let multiplierLevel = 1;
    let gameRunning = false;

    // LocalStorage keys
    const STORAGE_KEYS = {
      TROPHIES: 'blokz_trophies',
      LIVES: 'blokz_lives',
      MULTIPLIER_LEVEL: 'blokz_multiplier_level'
    };

    // Charger les donnÃ©es sauvegardÃ©es
    function loadData() {
      trophies = parseInt(localStorage.getItem(STORAGE_KEYS.TROPHIES)) || 0;
      lives = parseInt(localStorage.getItem(STORAGE_KEYS.LIVES)) || 3;
      multiplierLevel = parseInt(localStorage.getItem(STORAGE_KEYS.MULTIPLIER_LEVEL)) || 1;
      updateMultiplier();
    }

    // Sauvegarder les donnÃ©es
    function saveData() {
      localStorage.setItem(STORAGE_KEYS.TROPHIES, trophies);
      localStorage.setItem(STORAGE_KEYS.LIVES, lives);
      localStorage.setItem(STORAGE_KEYS.MULTIPLIER_LEVEL, multiplierLevel);
    }

    // Mettre Ã  jour le multiplicateur en fonction du niveau
    function updateMultiplier() {
      multiplier = 1 + (multiplierLevel - 1) * 0.5;
    }

    // Afficher la page demandÃ©e
    function showPage(pageId) {
      pages.forEach(id => {
        document.getElementById(id).classList.remove('active');
      });
      document.getElementById(pageId).classList.add('active');
      if (pageId === 'profile') updateProfile();
      if (pageId === 'shop') updateShop();
    }

    // Choisir la difficultÃ©, aller Ã  l'Ã©cran prÃªt
    function chooseDifficulty(diff) {
      gameDifficulty = diff;
      showPage('ready');
    }

    // Mise Ã  jour de l'affichage du profil
    function updateProfile() {
      document.getElementById('profileTrophies').textContent = trophies;
      document.getElementById('profileLives').textContent = lives;
      document.getElementById('profileMultiplier').textContent = multiplier.toFixed(1);
    }

    // Mise Ã  jour affichage boutique
    function updateShop() {
      document.getElementById('shopMultiplier').textContent = multiplier.toFixed(1);
      document.getElementById('nextMultiplier').textContent = (multiplier + 0.5).toFixed(1);
      const cost = multiplierLevel * 100;
      document.getElementById('multiplierCost').textContent = cost;
    }

    // Commencer le jeu aprÃ¨s Ã©cran prÃªt
    function startGame() {
      showPage('game');
      resetGame();
      countdownStart(() => {
        gameRunning = true;
        spawnBlock();
      });
    }

    // Reset variables au dÃ©but de partie
    function resetGame() {
      score = 0;
      lives = 3; // On remet 3 vies Ã  chaque partie
      updateMultiplier();
      updateHUD();
      clearBlocks();
    }

    // Mise Ã  jour HUD
    function updateHUD() {
      document.getElementById('lives').textContent = lives;
      document.getElementById('trophies').textContent = trophies;
      document.getElementById('multiplier').textContent = multiplier.toFixed(1);
      document.getElementById('score').textContent = score;
    }

    // Nettoyer les blocs du jeu
    function clearBlocks() {
      const gameArea = document.getElementById('gameArea');
      gameArea.innerHTML = '';
      blocks = [];
    }

    // Affichage du compte Ã  rebours avant dÃ©marrage
    function countdownStart(callback) {
      const countdownEl = document.getElementById('countdown');
      let count = 3;
      countdownEl.textContent = count;
      const interval = setInterval(() => {
        count--;
        if (count > 0) {
          countdownEl.textContent = count;
        } else {
          clearInterval(interval);
          countdownEl.textContent = '';
          callback();
        }
      }, 1000);
    }

    // GÃ©nÃ©rer un bloc alÃ©atoire dans le jeu
    function spawnBlock() {
      if (!gameRunning) return;
      const gameArea = document.getElementById('gameArea');

      // Taille de la zone jeu
      const maxX = gameArea.clientWidth - 60;
      const maxY = gameArea.clientHeight - 60;

      // Position alÃ©atoire
      const x = Math.floor(Math.random() * maxX);
      const y = Math.floor(Math.random() * maxY);

      // Couleur du bloc (25% gris, 75% colorÃ©)
      let color = 'gray';
      if (Math.random() < 0.75) {
        color = colors[Math.floor(Math.random() * colors.length)];
      }

      // CrÃ©ation du bloc
      const block = document.createElement('div');
      block.classList.add('block', color);
      block.style.left = x + 'px';
      block.style.top = y + 'px';
      block.dataset.color = color;

      // Ã‰vÃ©nement clic
      block.addEventListener('click', () => {
        if (!gameRunning) return;
        if (color === 'gray') {
          // Bloc gris cliquÃ© -> fin immÃ©diate
          endGame(true);
        } else {
          // Bloc colorÃ© cliquÃ© -> gagne points
          score++;
          trophies++;
          updateHUD();
          multiplierCheck();
          removeBlock(block);
          // ImmÃ©diatement spawn un autre bloc
          spawnBlock();
        }
      });

      gameArea.appendChild(block);
      blocks.push(block);

      // Timer disparition bloc selon difficultÃ©
      const timeout = difficulties[gameDifficulty];
      setTimeout(() => {
        if (!gameRunning) return;
        // Si le bloc est encore lÃ  => perte d'une vie si colorÃ©, sinon rien
        if (blocks.includes(block)) {
          if (color !== 'gray') {
            lives--;
            if (lives <= 0) {
              endGame();
              return;
            } else {
              updateHUD();
            }
          }
          removeBlock(block);
          // Spawn un nouveau bloc
          spawnBlock();
        }
      }, timeout);
    }

    // Enlever un bloc du jeu
    function removeBlock(block) {
      if (!block) return;
      const idx = blocks.indexOf(block);
      if (idx !== -1) blocks.splice(idx, 1);
      if (block.parentElement) block.parentElement.removeChild(block);
    }

    // VÃ©rifier si on peut augmenter multiplicateur selon score
    function multiplierCheck() {
      // Par exemple : +1 niveau tous les 10 points
      const newLevel = Math.floor(score / 10) + 1;
      if (newLevel > multiplierLevel) {
        multiplierLevel = newLevel;
        updateMultiplier();
        updateHUD();
      }
    }

    // Fin du jeu
    // clickedGray : boolÃ©en indiquant si fin immÃ©diate ou par perte de vie
    function endGame(clickedGray = false) {
      gameRunning = false;
      clearBlocks();
      saveData();

      // Ajouter les trophÃ©es gagnÃ©s en partie
      trophies += score * multiplier;
      trophies = Math.floor(trophies);
      saveData();

      // Afficher score final + trophÃ©es
      alert(`Fin du jeu!\nScore : ${score}\nTrophÃ©es gagnÃ©s : ${score * multiplier}\nTotal de trophÃ©es : ${trophies}`);

      // Retour accueil
      showPage('home');
      updateProfile();
    }

    // Acheter vie dans la boutique
    function buyLife() {
      const cost = 50;
      if (trophies >= cost) {
        trophies -= cost;
        lives++;
        saveData();
        updateShop();
        updateProfile();
        alert("Vie achetÃ©e !");
      } else {
        alert("TrophÃ©es insuffisants.");
      }
    }

    // AmÃ©liorer multiplicateur
    function upgradeMultiplier() {
      const cost = multiplierLevel * 100;
      if (trophies >= cost) {
        trophies -= cost;
        multiplierLevel++;
        updateMultiplier();
        saveData();
        updateShop();
        updateProfile();
        alert("Multiplicateur amÃ©liorÃ© !");
      } else {
        alert("TrophÃ©es insuffisants.");
      }
    }

    // Mode local (placeholder)
    function goToLocal() {
      showPage('local');
    }

    // Au chargement de la page
    window.onload = () => {
      loadData();
      updateProfile();
      updateHUD();
    };
  </script>
</body>
</html>




































